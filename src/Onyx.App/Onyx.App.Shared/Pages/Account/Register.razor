@page "/account/register"
@inject IUserManager UserManager
@inject ISnackbar Snackbar

<PageTitle>Register</PageTitle>

<MudContainer Style="height: 100vh" Class="ma-0 pa-0">
    <MudContainer Style="height: 100vh; position: absolute; z-index: -1000 !important"
                  Class="ma-0 pa-0 mud-width-full" MaxWidth="MaxWidth.False">
        <MudImage Src="/img/LoginBackground.png" Alt="Background" Elevation="-1"
                  Style="width: 100vw; height: 100vh; object-fit: fill;"/>
    </MudContainer>
    <MudContainer Style="height: 15vh; position: absolute;" Class="pa-0 ma-5 d-flex align-center">
        <MudImage Src="/img/Icon.png" Alt="Icon" Style="width: 7.5vw" Class="mr-2"/>
        <MudText Typo="Typo.h4" Style="color: #FFFFFF">Onyx</MudText>
    </MudContainer>
    <MudContainer Class="d-flex justify-center align-center mud-width-full"
                  MaxWidth="MaxWidth.Small" Style="height: 100vh">
        <MudContainer Style="border-radius: 2.5vw; 
                             background-color: #E4E4E4; 
                             opacity: 85%; 
                             padding: 4vw; 
                             color: #000000;"
                      Class="mud-width-full"
                      MaxWidth="MaxWidth.Small">
            <MudGrid Justify="Justify.Center"
                     Style="opacity: 100%; 
                            background-color: transparent;">
                <MudItem lg="8" md="8" sm="10" xs="10" Class="d-flex flex-column align-content-space-between 
                                justify-center">
                    <MudText Typo="Typo.h4"
                             Class="mb-3">Register</MudText>
                    <EditForm Model="m_RegisterModel" OnValidSubmit="Submit"
                              FormName="RegisterForm">
                        <DataAnnotationsValidator/>
                        <ValidationSummary/>

                        <MudTextField Class="mb-3" Label="Username" Variant="Variant.Outlined"
                                      @bind-Value="m_RegisterModel.Username" Required="true"/>
                        <MudTextField Class="mb-3" Label="Email" Variant="Variant.Outlined"
                                      @bind-Value="m_RegisterModel.Email" Required="true"
                                      InputType="InputType.Email"/>
                        <MudTextField Class="mb-3" Label="Password" Variant="Variant.Outlined"
                                      @bind-Value="m_RegisterModel.Password" Required="true"
                                      InputType="InputType.Password"/>
                        <MudTextField Class="mb-3" Label="Confirm Password" Variant="Variant.Outlined"
                                      @bind-Value="m_RegisterModel.ConfirmPassword" Required="true"
                                      InputType="InputType.Password"/>
                        <MudButton ButtonType="ButtonType.Submit"
                                   Variant="Variant.Filled"
                                   Class="rounded mud-button-full-width mb-3"
                                   Style="background-color: black">
                            Register
                        </MudButton>
                    </EditForm>

                    <MudText Align="Align.Center">Or sign up using</MudText>
                    <ExternalLoginPicker/>
                </MudItem>
            </MudGrid>



        </MudContainer>
    </MudContainer>
    <MudContainer Class="flex-column justify-center align-content-lg-space-between border-solid border-2 rounded mud-background">

    </MudContainer>
</MudContainer>

<EditForm Model="m_RegisterModel" OnValidSubmit="Submit">
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    <MudTextField Label="Username" @bind-Value="m_RegisterModel.Username" Required="true"/>
    <MudTextField Label="Email" @bind-Value="m_RegisterModel.Email" Required="true"/>
    <MudTextField Label="Password" @bind-Value="m_RegisterModel.Password" Required="true"
                  InputType="InputType.Password"/>
    <MudTextField Label="Confirm Password" @bind-Value="m_RegisterModel.ConfirmPassword" Required="true"
                  InputType="InputType.Password"/>
    <MudButton ButtonType="ButtonType.Submit">Register</MudButton>
</EditForm>

<ExternalLoginPicker />

@code {
    private readonly RegisterModel m_RegisterModel = new();

    private async Task Submit()
    {
        var result = await UserManager.RegisterAsync(m_RegisterModel.Username, 
            m_RegisterModel.Email, m_RegisterModel.Password, "/");
        if (result.Success)
        {
            // Redirect
        }
        else
        {
            // TODO
            Console.WriteLine("Error: " + result.Message);
        }
    }

    public class RegisterModel
    {
        [Required]
        public string Username { get; set; } = "";
        
        [EmailAddress]
        [Required]
        public string Email { get; set; } = "";
        
        [Required]
        public string Password { get; set; } = "";
        
        [Required]
        [Compare(nameof(Password))]
        public string ConfirmPassword { get; set; } = "";
    }

}