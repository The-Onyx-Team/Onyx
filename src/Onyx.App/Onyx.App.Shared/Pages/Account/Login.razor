@page "/account/login"
@inject IUserManager UserManager
@inject NavigationManager NavigationManager

<PageTitle>Login</PageTitle>

<MudContainer Style="height: 100vh" Class="ma-0 pa-0">
    <MudContainer Style="height: 100vh; position: absolute; z-index: -1000 !important" 
                  Class="ma-0 pa-0 mud-width-full" MaxWidth="MaxWidth.False">
        <MudImage Src="/img/LoginBackground.png" Alt="Background"               
                  ObjectFit="ObjectFit.Cover" Elevation="-1"/>
    </MudContainer>
    <MudContainer Class="d-flex justify-center align-center"
                  MaxWidth="MaxWidth.Small" Style="height: 100vh">
        <MudContainer Class="d-flex flex-column align-content-space-between 
                                justify-center border-solid border-2 rounded
                                mud-theme-tertiary" 
                      MaxWidth="MaxWidth.Small">
            <MudText Typo="Typo.h3" Color="Color.Surface"
                     Class="mb-3">Login</MudText>
            <EditForm Model="m_RegisterModel" OnValidSubmit="Submit" 
                      FormName="LoginForm">
                <DataAnnotationsValidator/>
                <ValidationSummary/>
                <MudTextField Class="mud-form mb-3" Label="Email" Variant="Variant.Outlined"
                              @bind-Value="m_RegisterModel.Email" 
                              InputType="InputType.Email"/>
                <MudTextField Class="mud-form" Label="Password" Variant="Variant.Outlined"
                              @bind-Value="m_RegisterModel.Password"
                              InputType="InputType.Password"/> 
                <MudLink Class="mb-3 d-flex justify-end" Href="" 
                         Underline="Underline.Always"
                         Color="Color.Primary">Forgot Password?</MudLink>
                <MudButton ButtonType="ButtonType.Submit" Color="Color.Dark"
                           Variant="Variant.Filled" 
                           Class="rounded mud-button-full-width mb-3">
                    Login
                </MudButton>
            </EditForm>

            <ExternalLoginPicker/>

            <MudText>No account?
                <MudLink Color="Color.Primary" Underline="Underline.Always"
                         Href="/account/register">Sign up</MudLink>
            </MudText>
        </MudContainer>
    </MudContainer>
        <MudContainer Class="flex-column justify-center align-content-lg-space-between border-solid border-2 rounded mud-background">
            
        </MudContainer>
</MudContainer>

@code {
    private readonly RegisterModel m_RegisterModel = new();

    private async Task Submit()
    {
        var result = await UserManager.LoginAsync(m_RegisterModel.Email, m_RegisterModel.Password, "/");
        if (result.Success)
        {
            NavigationManager.NavigateTo("/");
        }
        else
        {
            Console.WriteLine("Error: " + result.Message);
        }
    }

    public class RegisterModel
    {
        [EmailAddress]
        [Required]
        public string Email { get; set; } = "";
        
        [Required]
        public string Password { get; set; } = "";
    }

}