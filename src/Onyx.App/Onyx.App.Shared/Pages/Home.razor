@page "/home"
@layout AppLayout
@inject NavigationManager Manager

<MudContainer xmlns="http://www.w3.org/1999/html" Style="padding: 2vw">
    <MudGrid>
        <MudItem xs="12" sm="6" md="4">
            <MudDatePicker Label="Filter"
                           Editable="true"
                           @bind-Date="_date"
                           Mask="@(new DateMask("dd.MM.yyyy"))"
                           DateFormat="dd.MM.yyyy"
                           Placeholder="de-AT Date"
                           Variant="Variant.Filled"
                           Style="width: 100%;" />
        </MudItem>
    </MudGrid>

    <br/>
    
    <MudGrid Gutter="3">
        <MudItem xs="12" md="6">
            <MudPaper Elevation="3" Class="pa-4 mud-theme-dark">
                <MudText Typo="Typo.h6">Your goal</MudText>
                <br/>
                <MudPaper Class="doc-section-component-container">
                    <MudChart ChartType="ChartType.Line"
                              ChartSeries="@_monthlyAppData"
                              XAxisLabels="@_xAxisMonths"
                              Width="auto"
                              Height="38vh"/>
                </MudPaper>
            </MudPaper>
        </MudItem>
        
        <MudItem xs="12" md="6">
            <MudPaper Elevation="3" Class="pa-4 mud-theme-dark">
                <MudText Typo="Typo.h6">Top Categories</MudText>
                <br/>
                <MudTable Items="_appRanking">
                    <HeaderContent>
                        <MudTh>Rank</MudTh>
                        <MudTh>App</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Rank">@context.Key</MudTd>
                        <MudTd DataLabel="App Name">@context.Value</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Elevation="3" Class="pa-4 mud-theme-dark">
                <MudText Typo="Typo.h6">Today's report</MudText>
                <br/>
                <MudPaper Class="pa-4">
                    <MudChart ChartType="ChartType.Donut"
                              Width="auto"
                              Height="25vh"
                              InputData="@_todaysAppData"
                              InputLabels="@_labels">

                    </MudChart>
                </MudPaper>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Elevation="3" Class="pa-4 mud-theme-dark">
                <MudText Typo="Typo.h6">Weekly Report</MudText>
                <br/>
                <MudPaper Class="doc-section-component-container">
                    <MudChart ChartType="ChartType.StackedBar"
                              ChartSeries="@_weeklyAppData"
                              LegendPosition="Position.Bottom"
                              XAxisLabels="@_xAxisDays"
                              Width="auto"
                              Height="30vh"
                              AxisChartOptions="_axisChartOptions">
                    </MudChart>
                </MudPaper>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudDivider Class="my-4"/>

    <MudText Typo="Typo.h6">App Timer</MudText>
    <br/>
    <MudGrid Gutter="3">
        @foreach (var usage in _usageRestriction)
        {
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Elevation="2" Class="pa-4">
                    <MudText Typo="Typo.subtitle2">@usage.Title</MudText>
                    <MudText Typo="Typo.body1">@usage.Value</MudText>
                    <MudProgressLinear Color="@usage.Color" Value="@usage.Progress"/>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>

    <MudDivider Class="my-4"/>

    <MudPaper Elevation="4" Class="pa-6">
        <MudText Typo="Typo.h5">Trends</MudText>
        <MudText Typo="Typo.subtitle2">January - July 2023</MudText>
        <MudChart ChartType="ChartType.Line"
                  ChartSeries="@_monthlyAppData"
                  XAxisLabels="@_xAxisMonths"
                  Width="auto"
                  Height="50vh"/>
    </MudPaper>
    
</MudContainer>



@code {
    private DateTime? _date = DateTime.Today;
    
    readonly List<Metric> _usageRestriction =
    [
        new("Instagram", "1h 30min (40%)", 40, Color.Secondary),
        new("TikTok", "40min (20%)", 20, Color.Primary),
        new("Youtube", "1h 30min (60%)", 60, Color.Error),
        new("SnapChat", "1h 20min (80%)", 80, Color.Warning)
    ];

    public record Metric(string Title, string Value, double Progress, Color Color);
    
    //bar
    private readonly AxisChartOptions _axisChartOptions = new() { StackedBarWidthRatio = 0.5};


    private readonly List<ChartSeries> _weeklyAppData =
    [
        new() { Name = "Instagram", Data = [40, 20, 25, 27, 46, 60, 48] },
        new() { Name = "TikTok", Data = [19, 24, 35, 13, 28, 15, 13] },
        new() { Name = "YouTube", Data = [8, 6, 11, 13, 4, 16, 10] }
    ];
    private readonly string[] _xAxisDays = { "Mo, 05.05.", "Di, 06.05.", "Mi, 07.05.", "Do, 08.05.", "Fr, 09.05.", "Sa, 10.05.", "So, 11.05."};
    
    //Donut
    private readonly double[] _todaysAppData = { 50, 25, 20};
    private readonly string[] _labels = { "Instagram", "TikTok", "YouTube" };
    
    //Line
    private readonly List<ChartSeries> _monthlyAppData =
    [
        new() { Name = "Instagram", Data = [40, 20, 25, 27, 46, 60, 48] },
        new() { Name = "TikTok", Data = [19, 24, 35, 13, 28, 15, 13] },
        new() { Name = "YouTube", Data = [8, 6, 11, 13, 4, 16, 10] }
    ];
    private readonly string[] _xAxisMonths = { "Jan", "Feb", "Mar", "Apr", "May", "June", "July"};
    
    //List
    Dictionary<string, string> _appRanking = new Dictionary<string, string>
    {
        { "1.", "Instagram" },
        { "2.", "WhatsApp" },
        { "3.", "TikTok" },
        { "4.", "YouTube" },
        { "5.", "Snapchat" }
    };
}
